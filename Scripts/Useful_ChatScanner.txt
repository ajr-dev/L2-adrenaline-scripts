{
  It doesn't work in Interlude or maybe with version 1.71 of the box
  A simple example showing how you can scan all chat messages
  A simple example that logs all chat messages:
}

// unit Useful_ChatScanner

//interface

uses SysUtils;

var phrases: array of string = ['som', 'miracle'];   // we set lines which need to be looked for

//implementation

procedure CopyChatThread();
begin
  while  true  do begin
    if (ChatMessage.Unread) and (ChatMessage.Time < 3333) then begin
      Print(ChatMessage.Sender+': '+IntToStr(Ord(ChatMessage.ChatType))+' :'+ChatMessage.text);
    end;
    Delay(100);
  end;
end;

{begin
  Script.NewThread(@ChatScanerThread);
  Delay(-1);
end.}

// It can be slightly improved to find the ads we need:

procedure ChatScanerThread();
var i: integer;
begin
  Print('Started Chat Scanner Thread');
  while  true  do begin
    // mtSystem, mtAll, mtPrivate, mtParty, mtClan, mtFriend, mtShout
    if (ChatMessage.Unread) and (ChatMessage.ChatType = mtAll)  then begin
      for i:= Low(phrases) to High(phrases) do begin
        if (Pos(LowerCase(phrases[i]), LowerCase(ChatMessage.text)) > 0) then begin
          Print(ChatMessage.Sender+': '+ChatMessage.Text);
          PlaySound(ExePath+'\Sounds\msg.mp3');
          // Engine.SetGameWindow(true); // Undeclared in version 1.71
          break;
        end;
      end;
    end;
    Delay(100);
  end;
    Print('Ended Chat Scanner Thread');
end;

begin
  Script.NewThread(@ChatScanerThread);
end.
